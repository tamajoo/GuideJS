class Guidejs{constructor(e=document.body,t={},s={}){this.options={},Object.assign(this.options,{focusMode:"self",autostart:!1,locale:"",classes:{btnContainer:"",nextBtn:"",prevBtn:"",focusContainer:"",infoContainer:"",stepText:""},delay:null,beforeStart:function(){},afterStart:function(){},beforeNext:function(){},afterNext:function(){},beforePrev:function(){},afterPrev:function(){},beforeShowStep:function(){},afterShowStep:function(){},beforeStop:function(){},afterStop:function(){},beforeContinue:function(){},afterContinue:function(){}},t,e.dataset),this.translations={},Object.assign(this.translations,{default:{next:"Next",prev:"Back",pause:"Pause",close:"Close",continue:"Continue"}},s),this.elements={main:e},this.step=0,this._showStepDelay=0,this.elements.main.dispatchEvent(this._createEvent("guidejs.initialize")),this._setLocale(),this._initOverlay(),this._initButtons(),document.addEventListener("keyup",e=>{switch(e.which){case 27:this.stop();break;case 13:this.next()}}),this.elements.main.dispatchEvent(this._createEvent("guidejs.initialized")),console.log("initialized",this),this.options.autostart&&this.start()}_createEvent(e){return new CustomEvent(e,{bubbles:!0,guidejs:this})}_isDefined(e){return void 0!==e}_getText(e){let t=this.translations[this.options.locale];return this._isDefined(t)&&this._isDefined(t[e])?t[e]:this.translations.default[e]}_setLocale(){if(!this.options.locale){let e=document.documentElement.lang;this._isDefined(e)&&(this.options.locale=e)}}_initOverlay(){let e=document.createElement("div"),t=document.createElement("div");e.classList.add("gjs-ov"),t.classList.add("gjs-ghost"),document.body.appendChild(e),e.appendChild(t),e.addEventListener("click",this.stop,this),null===this.options.delay&&(this.options.delay=1e3*parseFloat(window.getComputedStyle(t).transitionDuration)),this.elements.overlay=e,this.elements.ghost=t}_initButtons(){let e=document.createElement("button"),t=document.createElement("button"),s=document.createElement("div");e.classList.add.apply(e.classList,["gjs-btn","gjs-btn-n"].concat((this.options.classes.nextBtn||"").split(" ")).filter(Boolean)),t.classList.add.apply(t.classList,["gjs-btn","gjs-btn-p"].concat((this.options.classes.prevBtn||"").split(" ")).filter(Boolean)),s.classList.add.apply(s.classList,["gjs-btns"].concat((this.options.classes.btnContainer||"").split()).filter(Boolean)),e.appendChild(document.createTextNode(this._getText("next"))),t.appendChild(document.createTextNode(this._getText("prev"))),e.addEventListener("click",this.next.bind(this)),t.addEventListener("click",this.prev.bind(this)),s.appendChild(t),s.appendChild(e),this.elements.nextBtn=e,this.elements.prevBtn=t,this.elements.btnWrap=s}_showOverlay(){this.elements.overlay.classList.add("gjs-open")}_hideOverlay(){this.elements.overlay.classList.remove("gjs-open")}_removeButtons(){this.elements.btnWrap.remove()}_clear(){if(this.elements.stepElem&&this.elements.focusElem){this.elements.textElem&&(this.elements.textElem.remove(),this.elements.textElem=null),this._removeButtons();let e=this.elements.focusElem;if(this.elements.focusElem!=this.elements.stepElem){e.parentNode;for(;e.firstChild;)parent.insertBefore(e.firstChild,e);e.remove(),this.elements.focusElem=null}else e.classList.remove("gjs-foc","gjs-ol",this.options.classes.focusContainer),e.style.backgroundColor="",e.style.outlineColor=""}}_focusElem(){switch(this.elements.stepElem.dataset.guidejsFocusMode||this.options.focusMode){case"wrapped":document.createElement("div").classList.add.apply(["gjs-foc"].concat((this.options.classes.focusContainer||"").split(" ")).filter(Boolean)),Throw("focusMode 'wrapped' not implemented, yet.");break;default:this.elements.focusElem=this.elements.stepElem,this.elements.focusElem.classList.add.apply(this.elements.focusElem.classList,["gjs-foc"].concat((this.options.classes.focusContainer||"").split(" ")).filter(Boolean))}this.elements.stepElem.matches("[data-guidejs-outline]")&&this.elements.focusElem.classList.add("gjs-ol"),this.elements.stepElem.dataset.guidejsBackground&&(this.elements.focusElem.style.backgroundColor=this.elements.stepElem.dataset.guidejsBackground,this.elements.focusElem.style.outlineColor=this.elements.stepElem.dataset.guidejsBackground),this._showButtons(),this._showText()}_showStep(){var e=this;setTimeout(function(){return e._showStepDelay=0,!1===e.options.beforeShowStep()?(e.elements.main.removeEventListener("guidejs.step.shown",e.options.afterNext),void e.elements.main.removeEventListener("guidejs.step.shown",e.options.afterPrev)):(e._clear(),e.elements.stepElem=e.elements.main.querySelector('[data-guidejs="'+e.step+'"]'),e.elements.stepElem?(e.elements.main.dispatchEvent(e._createEvent("guidejs.step.show")),e._updateGhost(),void setTimeout(function(){e._focusElem(),e.elements.main.dispatchEvent(e._createEvent("guidejs.step.shown")),e.options.afterShowStep()},e.options.delay)):e.stop())},this._showStepDelay)}_updateGhost(){let e={top:window.getComputedStyle(this.elements.stepElem).top},t=window.pageYOffset||document.documentElement.scrollTop;e.top=e.top-t,e.width=this.elements.stepElem.offsetWidth,e.height=this.elements.stepElem.offsetHeight,Object.apply(this.elements.ghost.css,e);let s=this;setTimeout(function(){s.elements.ghost.classList.remove("gjs-show-ghost")},this.options.delay)}_showButtons(){this.elements.focusElem.appendChild(this.elements.btnWrap)}_showText(){this.elements.stepElem.dataset.guidejsText&&(this.elements.textElem=document.createElement("div"),this.elements.textElem.classList.add.apply(this.elements.textElem.classList,["gjs-txt"].concat((this.options.classes.stepText||"").split()).filter(Boolean)),this.elements.textElem.innerHTML=this.elements.stepElem.dataset.guidejsText,this.elements.focusElem.appendChild(this.elements.textElem))}_checkTextPosition(){}_prevent(e){this._isDefined(e)&&"function"==typeof e.preventDefault&&e.preventDefault()}start(e){!1!==this.options.beforeStart()&&(this._prevent(e),this.step=0,this.next(),this._showOverlay())}stop(e){!1!==this.options.beforeStop()&&(this._prevent(e),this._clear(),this._hideOverlay(),this.options.afterStop())}continue(e){!1!==this.options.beforeContinue()&&(this._prevent(e),this._showOverlay(),this._showStep(),this.options.afterContinue())}next(e){this._prevent(e),!1!==this.options.beforeNext()&&(this.step++,this._showStep())}prev(e){!1!==this.options.beforePrev()&&(this._prevent(e),this.step--,this._showStep())}delayShowStep(e){this._showStepDelay=e}}
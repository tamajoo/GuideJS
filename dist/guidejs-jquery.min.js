!function(o){o.widget("ui.guidejs",{version:"1",options:{focusMode:"self",autostart:!1,locale:"",classes:{btnContainer:"",nextBtn:"",prevBtn:"",focusContainer:"",infoContainer:"",stepText:""},delay:null,regional:{},beforeStart:function(){},afterStart:function(){},beforeNext:function(t,s){},afterNext:function(){},beforePrev:function(t,s){},afterPrev:function(){},beforeShowStep:function(){},afterShowStep:function(){},beforeStop:function(){},afterStop:function(){},beforeContinue:function(){},afterContinue:function(){}},regional:{default:{next:"Next",prev:"Back",pause:"Pause",close:"Close",continue:"Continue"}},$overlay:null,$ghost:null,$btnWrap:null,$nextBtn:null,$prevBtn:null,$stepElem:null,$textElem:null,$focusElem:null,step:0,_showStepDelay:0,_destroy:function(){var t=this;t._clear(),t.$overlay.remove(),t.options=null},_create:function(){},_init:function(){this.element.trigger("guidejs.initialize",[this]),this.options=o.extend(!0,this.options,this.element.data()),this.regional=o.extend(!0,this.regional,this.options.regional),this._setLocale(),this._initOverlay(),this._initButtons(),this._on(o(document),{keyup:function(t){switch(t.which){case 27:this.stop();break;case 13:this.next()}}}),this.element.trigger("guidejs.initialized",[this]),this.options.autostart&&this.start()},_isDefined:function(t){return void 0!==t},_getText:function(t){return this._isDefined(this.regional[this.options.locale])&&this._isDefined(this.regional[this.options.locale][t])?this.regional[this.options.locale][t]:this.regional.default[t]},_setLocale:function(){if(!this.options.locale){var t=o("html").attr("lang");this._isDefined(t)&&(this.options.locale=t)}},_initOverlay:function(){this.$overlay=o('<div class="gjs-ov">'),this._on(this.$overlay,{click:this.stop}),this.element.append(this.$overlay),this.$ghost=o('<div class="gjs-ghost">'),this.$overlay.append(this.$ghost),null===this.options.delay&&(this.options.delay=1e3*parseFloat(getComputedStyle(this.$ghost.get(0)).transitionDuration))},_initButtons:function(){this.$nextBtn=o('<button class="gjs-btn gjs-btn-n '+this.options.classes.nextBtn+'">'+this._getText("next")+"</button>"),this.$prevBtn=o('<button class="gjs-btn gjs-btn-p '+this.options.classes.prevBtn+'">'+this._getText("prev")+"</button>"),this._on(this.$nextBtn,{click:this.next}),this._on(this.$prevBtn,{click:this.prev}),this.$btnWrap=o('<div class="'+this.options.classes.btnContainer+' gjs-btns">'),this.$btnWrap.append(this.$prevBtn,this.$nextBtn)},_showOverlay:function(){this.$overlay.addClass("gjs-open")},_hideOverlay:function(){this.$overlay.removeClass("gjs-open")},_detachButtons:function(){this.$btnWrap.detach()},_clear:function(){this.$stepElem&&(this.$textElem&&(this.$textElem.remove(),this.$textElem=null),this._detachButtons(),this.$focusElem!=this.$stepElem?this.$stepElem.unwrap():this.$focusElem.removeClass("gjs-foc gjs-ol "+this.options.classes.focusContainer).css({backgroundColor:"",outlineColor:""}))},_focusElem:function(){switch(this.$stepElem.data("guidejs-focus-mode")||this.options.focusMode){case"wrapped":$wrap=o('<div class="gjs-foc '+this.options.classes.focusContainer+'"></div>'),this.$stepElem.wrap($wrap),this.$focusElem=this.$stepElem.parent();break;default:this.$focusElem=this.$stepElem,this.$focusElem.addClass("gjs-foc "+this.options.classes.focusContainer)}this.$stepElem.is("[data-guidejs-outline]")&&this.$focusElem.addClass("gjs-ol"),this.$stepElem.data("guidejs-background")&&this.$focusElem.css({backgroundColor:this.$stepElem.data("guidejs-background"),outlineColor:this.$stepElem.data("guidejs-background")}),this._showButtons(),this._showText()},_showStep:function(){var t=this;setTimeout(function(){return t._showStepDelay=0,!1===t.options.beforeShowStep()?(t.element.off("guidejs.step.shown",t.options.afterNext),void t.element.off("guidejs.step.shown",t.options.afterPrev)):(t._clear(),t.$stepElem=t.element.find('[data-guidejs="'+t.step+'"]').first(),t.$stepElem.length?(t.element.trigger("guidejs.step.show",[t,t.$stepElem]),t._updateGhost(),void setTimeout(function(){t._focusElem(),t.element.trigger("guidejs.step.shown",[t,t.$stepElem]),t.options.afterShowStep()},t.options.delay)):t.stop())},this._showStepDelay)},_updateGhost:function(){var t=this.$stepElem.offset(),s=o(window).scrollTop();if(t.top=t.top-s,t.width=this.$stepElem.outerWidth(),t.height=this.$stepElem.outerHeight(),this._isDefined(this.$ghost.data("lastScrollTop"))&&this.$ghost.data("lastScrollTop")!=s){var e="+="+(this.$ghost.data("lastScrollTop")-s);this.$ghost.addClass("gjs-no-anim").css({top:e}).removeClass("gjs-no-anim")}this.$ghost.data("lastScrollTop",s).addClass("gjs-show-ghost").removeClass("gjs-ol"),this.$stepElem.is("[data-guidejs-outline]")&&this.$ghost.addClass("gjs-ol"),this.$ghost.css(t);var i=this;setTimeout(function(){i.$ghost.removeClass("gjs-show-ghost")},this.options.delay)},_showButtons:function(){this.$focusElem.append(this.$btnWrap)},_showText:function(){this.$stepElem.data("guidejs-text")&&(this.$textElem=o('<div class="gjs-txt '+this.options.classes.stepText+'"></div>'),this.$textElem.html(this.$stepElem.data("guidejs-text")),this.$focusElem.append(this.$textElem)),this._checkTextPosition()},_checkTextPosition:function(){this.$textElem.removeClass("gjs-txt-left");var t=this.$textElem.offset().left,s=this.$textElem.outerWidth();this.element.offset().left+this.element.width()<t+s&&this.$textElem.addClass("gjs-txt-left")},_prevent:function(t){this._isDefined(t)&&"function"==typeof t.preventDefault&&t.preventDefault()},start:function(t){!1!==this.options.beforeStart()&&(this._prevent(t),this.step=0,this.next(),this._showOverlay(),this.options.afterStart())},stop:function(t){!1!==this.options.beforeStop()&&(this._prevent(t),this._clear(),this._hideOverlay(),this.options.afterStop())},continue:function(t){!1!==this.options.beforeContinue()&&(this._prevent(t),this._showOverlay(),this._showStep(),this.options.afterContinue())},next:function(t){!1!==this.options.beforeNext(this.$stepElem,this.element.find('[data-guidejs="'+(this.step+1)+'"]').first())&&(this.element.one("guidejs.step.shown",this.options.afterNext),this._prevent(t),this.step++,this._showStep())},prev:function(t){!1!==this.options.beforePrev(this.$stepElem,this.element.find('[data-guidejs="'+(this.step-1)+'"]').first())&&(this.element.one("guidejs.step.shown",this.options.afterPrev),this._prevent(t),this.step--,this._showStep())},delayShowStep:function(t){this._showStepDelay=t}})}(jQuery);
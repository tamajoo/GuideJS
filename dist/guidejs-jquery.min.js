!function(s){s.widget("ui.guide",{version:"1",options:{focusMode:"self",autostart:!1,locale:"",classes:{btnContainer:"",nextBtn:"",prevBtn:"",focusContainer:"",infoContainer:"",stepText:""},delay:null,beforeStart:function(){},afterStart:function(){},beforeNext:function(){},afterNext:function(){},beforePrev:function(){},afterPrev:function(){},beforeShowStep:function(){},afterShowStep:function(){},beforeStop:function(){},afterStop:function(){},beforeContinue:function(){},afterContinue:function(){}},regional:{default:{next:"Next",prev:"Back",pause:"Pause",close:"Close",continue:"Continue"}},$overlay:null,$ghost:null,$btnWrap:null,$nextBtn:null,$prevBtn:null,$stepElem:null,$textElem:null,$focusElem:null,step:0,_destroy:function(){var t=this;t._clear(),t.$overlay.remove(),t.options=null},_create:function(){},_init:function(){this.element.trigger("guidejs.initialize",[this]),this.options=s.extend(!0,this.options,this.element.data()),this._setLocale(),this._initOverlay(),this._initButtons(),this._on(s(document),{keyup:function(t){switch(t.which){case 27:this.stop();break;case 13:this.next()}}}),this.element.trigger("guidejs.initialized",[this]),this.options.autostart&&this.start()},_isDefined:function(t){return void 0!==t},_getText:function(t){return this._isDefined(this.regional[this.locale])&&this._isDefined(this.regional[this.locale][t])?this.regional[this.locale][t]:this.regional.default[t]},_setLocale:function(){if(!this.options.locale){var t=s(document).attr("lang");this._isDefined(t)&&(this.options.locale=t)}},_initOverlay:function(){this.$overlay=s('<div class="gjs-ov">'),this._on(this.$overlay,{click:this.stop}),this.element.append(this.$overlay),this.$ghost=s('<div class="gjs-ghost">'),this.$overlay.append(this.$ghost),null===this.options.delay&&(this.options.delay=1e3*parseFloat(getComputedStyle(this.$ghost.get(0)).transitionDuration))},_initButtons:function(){this.$nextBtn=s('<button class="gjs-btn gjs-btn-n '+this.options.classes.nextBtn+'">'+this._getText("next")+"</button>"),this.$prevBtn=s('<button class="gjs-btn gjs-btn-p '+this.options.classes.prevBtn+'">'+this._getText("prev")+"</button>"),this._on(this.$nextBtn,{click:this.next}),this._on(this.$prevBtn,{click:this.prev}),this.$btnWrap=s('<div class="'+this.options.classes.btnContainer+' gjs-btns">'),this.$btnWrap.append(this.$prevBtn,this.$nextBtn)},_showOverlay:function(){this.$overlay.addClass("gjs-open")},_hideOverlay:function(){this.$overlay.removeClass("gjs-open")},_detachButtons:function(){this.$btnWrap.detach()},_clear:function(){this.$stepElem&&(this.$textElem&&(this.$textElem.remove(),this.$textElem=null),this._detachButtons(),this.$focusElem!=this.$stepElem?this.$stepElem.unwrap():this.$focusElem.removeClass("gjs-foc gjs-ol "+this.options.classes.focusContainer).css({backgroundColor:"",outlineColor:""}))},_focusElem:function(){switch(this.$stepElem.data("guidejs-focus-mode")||this.options.focusMode){case"wrapped":$wrap=s('<div class="gjs-foc '+this.options.classes.focusContainer+'"></div>'),this.$stepElem.wrap($wrap),this.$focusElem=this.$stepElem.parent();break;default:this.$focusElem=this.$stepElem,this.$focusElem.addClass("gjs-foc "+this.options.classes.focusContainer)}this.$stepElem.is("[data-guidejs-outline]")&&this.$focusElem.addClass("gjs-ol"),this.$stepElem.data("guidejs-background")&&this.$focusElem.css({backgroundColor:this.$stepElem.data("guidejs-background"),outlineColor:this.$stepElem.data("guidejs-background")}),this._showButtons(),this._showText()},_showStep:function(){if(!1===this.options.beforeShowStep())return t.element.off("guidejs.step.shown",this.options.afterNext),void t.element.off("guidejs.step.shown",this.options.afterPrev);if(this._clear(),this.$stepElem=this.element.find('[data-guidejs="'+this.step+'"]').first(),!this.$stepElem.length)return this.stop();this.element.trigger("guidejs.step.show",[this,this.$stepElem]),this._updateGhost();var t=this;setTimeout(function(){t._focusElem(),t.element.trigger("guidejs.step.shown",[t,t.$stepElem]),t.options.afterShowStep()},this.options.delay)},_updateGhost:function(){var t=this.$stepElem.offset(),e=s(window).scrollTop();t.top=t.top-e,t.width=this.$stepElem.outerWidth(),t.height=this.$stepElem.outerHeight(),this.$ghost.removeClass("gjs-ol"),this.$stepElem.is("[data-guidejs-outline]")&&this.$ghost.addClass("gjs-ol"),this.$ghost.css(t)},_showButtons:function(){this.$focusElem.append(this.$btnWrap)},_showText:function(){this.$stepElem.data("guidejs-text")&&(this.$textElem=s('<div class="gjs-txt '+this.options.classes.stepText+'"></div>'),this.$textElem.html(this.$stepElem.data("guidejs-text")),this.$focusElem.append(this.$textElem))},_prevent:function(t){this._isDefined(t)&&"function"==typeof t.preventDefault&&t.preventDefault()},start:function(t){!1!==this.options.beforeStart()&&(this._prevent(t),this.step=0,this.next(),this._showOverlay(),this.options.afterStart())},stop:function(t){!1!==this.options.beforeStop()&&(this._prevent(t),this._clear(),this._hideOverlay(),this.options.afterStop())},continue:function(t){!1!==this.options.beforeContinue()&&(this._prevent(t),this._showOverlay(),this.options.afterContinue())},next:function(t){!1!==this.options.beforeNext()&&(this.element.one("guidejs.step.shown",this.options.afterNext),this._prevent(t),this.step++,this._showStep())},prev:function(t){!1!==this.options.beforePrev()&&(this.element.one("guidejs.step.shown",this.options.afterPrev),this._prevent(t),this.step--,this._showStep())}})}(jQuery);